eControl: Plan Maestro Completo
Antes de Escribir una LÃ­nea de CÃ³digo

1. STACK TECNOLÃ“GICO DEFINITIVO
1.1 Resumen Ejecutivo del Stack
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   STACK FINAL                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CLIENT SIDE (PC del LAN):
â”œâ”€ Agent Core: Rust (Windows Service) 
â”œâ”€ Agent UI: Tauri + React + TypeScript
â””â”€ Local DB: SQLite

BACKEND (Cloud):
â”œâ”€ API: Node.js + NestJS + TypeScript
â”œâ”€ Realtime: Socket.io (WebSockets)
â”œâ”€ Database: PostgreSQL 16
â”œâ”€ Cache: Redis 7
â”œâ”€ Queue: BullMQ
â””â”€ Storage: MinIO (S3-compatible)

WEB CLIENTS:
â”œâ”€ Admin Dashboard: Next.js 14 (App Router) + TypeScript
â”œâ”€ Public Site: Next.js 14 (marketing/landing)
â””â”€ UI Library: shadcn/ui + Tailwind CSS

MOBILE:
â””â”€ Apps: Flutter (iOS + Android)

INFRASTRUCTURE:
â”œâ”€ Containerization: Docker + Docker Compose
â”œâ”€ Orchestration: Kubernetes (post-scale)
â”œâ”€ CI/CD: GitHub Actions
â”œâ”€ Monitoring: Grafana + Prometheus + Loki
â”œâ”€ Cloud: AWS / DigitalOcean / Hetzner
â””â”€ CDN: Cloudflare

2. JUSTIFICACIÃ“N DE CADA DECISIÃ“N TECNOLÃ“GICA
2.1 Â¿Por quÃ© Rust para el Agent Core?
Alternativas consideradas:

âŒ Electron: Footprint inaceptable (100-300 MB RAM)
âŒ .NET: Bueno, pero queremos Rust skills en el equipo
âœ… Rust puro: Footprint mÃ­nimo (15-20 MB RAM)

Ventajas especÃ­ficas:

Memory safety sin garbage collector
Performance nativa (comparable a C++)
Excelente para system programming (hooks, services)
Cross-compilation (futuro: Linux LAN centers)
Comunidad activa en tooling de sistema

Desventajas aceptadas:

Curva de aprendizaje pronunciada
CompilaciÃ³n mÃ¡s lenta que Node.js
Menos developers disponibles

DecisiÃ³n: El footprint y performance justifican la inversiÃ³n en aprendizaje.

2.2 Â¿Por quÃ© Tauri para el Agent UI?
Alternativas consideradas:

âŒ Electron: Descartado por peso
âŒ .NET WPF: UI menos moderna
âŒ Rust GUI puro (iced/egui): Ecosistema inmaduro
âœ… Tauri: Balance perfecto

Ventajas especÃ­ficas:

Usa WebView nativo (no embeds Chromium)
Frontend con tecnologÃ­as web modernas (React)
Binario final: 3-8 MB
ComunicaciÃ³n limpia con el Service vÃ­a HTTP local
Hot reload durante desarrollo

Desventajas aceptadas:

Dos procesos corriendo (Service + Tray)
ComunicaciÃ³n inter-proceso aÃ±ade complejidad

DecisiÃ³n: La separaciÃ³n de concerns es arquitectÃ³nicamente superior. El Service hace el trabajo pesado, el Tray solo presenta informaciÃ³n.

2.3 Â¿Por quÃ© Node.js + NestJS para el Backend?
Alternativas consideradas:

âŒ Rust (Axum): Excelente performance pero desarrollo mÃ¡s lento
âŒ Go: Muy bueno, pero ecosistema mÃ¡s pequeÃ±o
âŒ Python (Django/FastAPI): MÃ¡s lento, no type-safe nativamente
âœ… Node.js + NestJS: Developer velocity Ã³ptima

Ventajas especÃ­ficas:

TypeScript = Type safety comparable a Rust/Go
NestJS = Arquitectura enterprise (modular, testeable)
Ecosistema npm gigantesco
FÃ¡cil encontrar developers Sr/Mid
Prisma ORM es excepcional
Socket.io maduro para WebSockets
Async/await natural para I/O-bound operations

Desventajas aceptadas:

Performance inferior a Rust/Go (pero suficiente para nuestro caso)
Consumo de memoria mÃ¡s alto en servidor

DecisiÃ³n: Time-to-market es crÃ­tico para un MVP. Node.js acelera desarrollo 2-3x vs Rust backend.

2.4 Â¿Por quÃ© Next.js 14 para Admin Dashboard?
Alternativas consideradas:

âŒ Create React App: Deprecated, no SSR
âŒ Vite + React: Excelente, pero sin SSR/SSG out-of-box
âŒ Remix: Muy bueno, pero menor ecosistema
âœ… Next.js 14 (App Router): EstÃ¡ndar de facto

Ventajas especÃ­ficas:

Server Components = Mejor performance inicial
Server Actions = API calls simplificadas
File-based routing = OrganizaciÃ³n intuitiva
Built-in optimizaciones (Image, Font, etc.)
Streaming SSR = UX superior en dashboards complejos
Middleware = Auth/RBAC centralizado
Vercel deployment = Trivial (opcional)

Por quÃ© App Router (no Pages Router):

Es el futuro de Next.js
Mejor separaciÃ³n server/client components
Layouts anidados mÃ¡s intuitivos
React Server Components nativo

Desventajas aceptadas:

Curva de aprendizaje (App Router es nuevo)
Algunos paquetes no compatibles con Server Components

DecisiÃ³n: El Dashboard es complejo (mapas, grÃ¡ficos, tiempo real). Next.js maneja esta complejidad mejor que cualquier alternativa.

2.5 Â¿Por quÃ© Flutter para Mobile?
Alternativas consideradas:

âŒ React Native: Buen ecosistema, pero performance inferior
âŒ Native (Swift + Kotlin): Mejor performance, pero doble codebase
âœ… Flutter: Single codebase, performance casi nativa

Ventajas especÃ­ficas:

Hot reload espectacular
UI consistente iOS/Android
Dart es type-safe y performante
Widgets ricos out-of-box
CompilaciÃ³n a cÃ³digo nativo (no bridge JS)

Desventajas aceptadas:

Dart es otro lenguaje que aprender
Apps mÃ¡s pesadas que native (~20 MB overhead)

DecisiÃ³n: Para un equipo pequeÃ±o, mantener dos codebases nativos es inviable. Flutter es el mejor compromiso.

2.6 Â¿Por quÃ© PostgreSQL?
Alternativas consideradas:

âŒ MySQL: Menos features avanzadas
âŒ MongoDB: No-SQL no apropiado para datos transaccionales
âŒ SQLite: No apto para multi-tenant cloud
âœ… PostgreSQL: Base de datos mÃ¡s completa

Ventajas especÃ­ficas:

ACID compliant (crÃ­tico para billing)
JSON/JSONB columns (flexibilidad cuando necesario)
Extensions poderosas (PostGIS, pg_cron, timescaledb)
Prisma tiene excelente soporte
Performance excelente con Ã­ndices correctos
Open source, sin vendor lock-in


2.7 Â¿Por quÃ© Redis?
Usos especÃ­ficos en eControl:

Session storage (JWT blacklist, user sessions)
Cache de queries frecuentes (stats, leaderboards)
Rate limiting
BullMQ queue backend
Pub/Sub para eventos en tiempo real

Alternativa: Valkey (fork open-source post Redis license change)

2.8 Â¿Por quÃ© Docker + Kubernetes?
Fase MVP (Mes 1-12):

Docker Compose suficiente
Deploy en VPS Ãºnico (DigitalOcean droplet)

Fase Crecimiento (Mes 13+):

Kubernetes cuando >100 LANs activos
Auto-scaling necesario
Multi-region deployment


3. ARQUITECTURA DE DATOS
3.1 Modelo de Datos Conceptual
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ENTIDADES CORE                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

USER (Usuario)
â”œâ”€ id, email, username, passwordHash
â”œâ”€ phone, balance, loyaltyPoints, membershipTier
â”œâ”€ role (SUPER_ADMIN, MANAGER, CASHIER, CLIENT)
â”œâ”€ createdAt, updatedAt, lastVisit
â””â”€ Relaciones: sessions[], reservations[], orders[]

LAN_CENTER (Centro de Gaming)
â”œâ”€ id, name, address, timezone
â”œâ”€ ownerId (User)
â”œâ”€ settings (JSON: tarifas, horarios, etc.)
â”œâ”€ status (ACTIVE, SUSPENDED, TRIAL)
â””â”€ Relaciones: zones[], staff[], subscriptions[]

ZONE (Zona dentro del LAN)
â”œâ”€ id, name, lanCenterId
â”œâ”€ baseRate ($ por hora)
â”œâ”€ description
â””â”€ Relaciones: pcs[]

PC (Computadora)
â”œâ”€ id, name (ej: "PC #01"), zoneId
â”œâ”€ specs (JSON: GPU, CPU, RAM)
â”œâ”€ status (AVAILABLE, OCCUPIED, RESERVED, MAINTENANCE)
â”œâ”€ agentVersion, lastHeartbeat
â””â”€ Relaciones: sessions[], reservations[], maintenanceLogs[]

SESSION (SesiÃ³n de juego)
â”œâ”€ id, userId, pcId, lanCenterId
â”œâ”€ startedAt, endedAt, durationSeconds
â”œâ”€ ratePerMinute, totalCost
â”œâ”€ status (ACTIVE, COMPLETED, ABORTED)
â”œâ”€ paymentMethod
â””â”€ Relaciones: user, pc, transactions[]

RESERVATION (Reserva)
â”œâ”€ id, userId, pcId, lanCenterId
â”œâ”€ reservedFor (datetime), durationMinutes
â”œâ”€ depositAmount, totalCost
â”œâ”€ status (PENDING, CONFIRMED, CHECKED_IN, COMPLETED, CANCELLED, NO_SHOW)
â”œâ”€ cancellationReason, penaltyApplied
â””â”€ Relaciones: user, pc, payment

PRODUCT (Productos de tienda)
â”œâ”€ id, lanCenterId, name, category
â”œâ”€ price, cost, stock
â”œâ”€ imageUrl, description
â”œâ”€ isActive
â””â”€ Relaciones: orderItems[]

ORDER (Orden de tienda)
â”œâ”€ id, userId, sessionId, lanCenterId
â”œâ”€ items (JSON or relation), totalAmount
â”œâ”€ status (PENDING, PREPARING, READY, DELIVERED, CANCELLED)
â”œâ”€ orderedAt, deliveredAt
â””â”€ Relaciones: user, session, orderItems[]

TRANSACTION (Transacciones financieras)
â”œâ”€ id, userId, lanCenterId
â”œâ”€ type (RECHARGE, SESSION_PAYMENT, STORE_PURCHASE, REFUND, PENALTY)
â”œâ”€ amount, balanceBefore, balanceAfter
â”œâ”€ paymentMethod, reference
â”œâ”€ createdAt
â””â”€ Relaciones: user, session?, order?

LOYALTY_REWARD (Recompensas)
â”œâ”€ id, userId, type (CASHBACK, FREE_HOURS, DISCOUNT_COUPON)
â”œâ”€ value, expiresAt
â”œâ”€ status (PENDING, REDEEMED, EXPIRED)
â””â”€ Relaciones: user

MAINTENANCE_LOG (Mantenimientos)
â”œâ”€ id, pcId, performedBy (userId)
â”œâ”€ issue, action, cost
â”œâ”€ performedAt
â””â”€ Relaciones: pc, user
3.2 Relaciones CrÃ­ticas
User 1:N Session (un usuario tiene muchas sesiones)
PC 1:N Session (una PC tiene muchas sesiones)
User 1:N Reservation
PC 1:N Reservation
Session 1:N Transaction (una sesiÃ³n puede generar mÃºltiples transacciones)
User 1:N Transaction
Order 1:N OrderItem
Product 1:N OrderItem
LAN_CENTER 1:N Zone
Zone 1:N PC
LAN_CENTER 1:N User (staff)

4. FLUJOS DE DATOS CRÃTICOS
4.1 Flujo: Inicio de SesiÃ³n
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FLUJO: Cliente inicia sesiÃ³n en PC                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[Cliente] â†’ Se acerca al mostrador con su usuario

[Cajero] â†’ Abre Next.js Dashboard
         â†’ Busca usuario (por username, email, o phone)
         â†’ Verifica saldo disponible
         â†’ Selecciona PC disponible en mapa interactivo
         â†’ Clic en "Iniciar SesiÃ³n"

[Backend] â†’ Valida datos
          â†’ Crea registro de Session (status: ACTIVE)
          â†’ Genera SessionToken
          â†’ EnvÃ­a comando al Agent vÃ­a WebSocket:
            {
              type: "START_SESSION",
              sessionId: "...",
              userId: "...",
              ratePerMinute: 0.05,
              balance: 10.00
            }

[Agent Service (Rust)] 
          â†’ Recibe comando WebSocket
          â†’ Inicia SessionManager local
          â†’ Desbloquea PC (sale de kiosk mode parcial)
          â†’ Inicia timer local (cuenta cada segundo)
          â†’ Guarda en SQLite local (backup offline)
          â†’ Responde ACK al backend

[Agent Tray (Tauri)] 
          â†’ Recibe notificaciÃ³n del Service
          â†’ Muestra overlay de bienvenida:
            "SesiÃ³n iniciada. Bienvenido, Juan!"
          â†’ Se minimiza a system tray

[Cliente] â†’ Empieza a jugar

[Agent Service] 
          â†’ Cada 60 segundos: envÃ­a heartbeat al backend
            {
              type: "HEARTBEAT",
              sessionId: "...",
              timeElapsed: 120,
              currentCost: 0.10
            }
          â†’ Cada 1 segundo: actualiza timer local
          â†’ Si falla conexiÃ³n: continÃºa contando offline

[Backend] â†’ Recibe heartbeats
          â†’ Actualiza Session.durationSeconds
          â†’ Calcula totalCost actual
          â†’ Verifica balance del usuario
          â†’ Si balance < cost â†’ envÃ­a advertencia

[Agent Service] 
          â†’ Si balance bajo (5 min restantes):
            Notifica al Tray â†’ muestra alerta al usuario

[Usuario] â†’ Puede extender tiempo desde Tray
          â†’ O ignorar y continuar hasta que se acabe
4.2 Flujo: FinalizaciÃ³n de SesiÃ³n
[Opciones de finalizaciÃ³n]
A) Usuario termina voluntariamente (clic en "Finalizar")
B) Se acaba el saldo
C) Cajero finaliza desde Dashboard

[Cualquier caso] â†’

[Agent Service] 
          â†’ Detiene timer
          â†’ Calcula costo final
          â†’ Guarda en SQLite local
          â†’ EnvÃ­a al backend:
            {
              type: "END_SESSION",
              sessionId: "...",
              finalDuration: 3600,
              finalCost: 3.00
            }
          â†’ Bloquea PC (vuelve a kiosk mode completo)

[Backend] â†’ Actualiza Session (status: COMPLETED, endedAt, totalCost)
          â†’ Crea Transaction (type: SESSION_PAYMENT)
          â†’ Descuenta del balance del usuario
          â†’ Calcula loyalty points ganados
          â†’ Si hay rewards pending â†’ los aplica

[Next.js Dashboard] 
          â†’ Actualiza mapa (PC pasa a AVAILABLE)
          â†’ Muestra notificaciÃ³n: "SesiÃ³n finalizada - $3.00"
          â†’ Imprime ticket (opcional)
4.3 Flujo: Compra en Tienda (sin interrumpir juego)
[Usuario jugando] â†’ Presiona Ctrl+Shift+E

[Agent Tray] â†’ Muestra overlay
             â†’ Usuario navega a "Tienda"
             â†’ Ve productos disponibles (Coca Cola, snacks, etc.)
             â†’ AÃ±ade al carrito
             â†’ Confirma orden

[Agent Tray] â†’ EnvÃ­a al Service:
               {
                 type: "PLACE_ORDER",
                 sessionId: "...",
                 items: [{productId: "...", quantity: 2}]
               }

[Agent Service] â†’ EnvÃ­a al backend vÃ­a HTTP:
                  POST /orders
                  { sessionId, items }

[Backend] â†’ Valida balance del usuario
          â†’ Crea Order (status: PENDING)
          â†’ Descuenta del balance
          â†’ Crea Transaction
          â†’ Notifica a cocina/bar vÃ­a WebSocket

[Dashboard de Cocina] 
          â†’ Recibe notificaciÃ³n
          â†’ Muestra orden:
            "PC #07 - Juan: 2x Coca Cola"
          â†’ Staff prepara orden
          â†’ Clic en "Listo para entregar"

[Backend] â†’ Actualiza Order (status: READY)
          â†’ EnvÃ­a notificaciÃ³n al Agent

[Agent Tray] â†’ Muestra notificaciÃ³n push:
               "Tu pedido estÃ¡ listo ğŸ•"

[Staff] â†’ Entrega productos en el asiento del cliente
        â†’ Marca como DELIVERED en Dashboard

[Usuario] â†’ Sigue jugando sin haber parado
4.4 Flujo: Reserva desde Mobile App
[Usuario] â†’ Abre Flutter App
          â†’ Login con email/password
          â†’ Navega a "Reservar"

[App] â†’ Muestra calendario
      â†’ Usuario selecciona fecha y hora
      â†’ App consulta backend: GET /reservations/availability

[Backend] â†’ Consulta PCs disponibles para ese slot
          â†’ Retorna lista con zonas y precios

[App] â†’ Muestra mapa interactivo del LAN
      â†’ Usuario selecciona PC especÃ­fica (ej: PC #12 en zona VIP)
      â†’ Muestra precio: $2.00 depÃ³sito + tarifa normal al llegar
      â†’ Usuario confirma

[Backend] â†’ Crea Reservation (status: PENDING)
          â†’ Genera QR code Ãºnico
          â†’ Procesa pago de depÃ³sito (Stripe/Mercado Pago)
          â†’ Si pago exitoso â†’ status: CONFIRMED
          â†’ EnvÃ­a email/SMS con confirmaciÃ³n + QR

[Usuario] â†’ Recibe notificaciÃ³n: "Reserva confirmada"

[DÃ­a de la reserva, 1 hora antes]
[Backend] â†’ Cron job detecta reservas prÃ³ximas
          â†’ EnvÃ­a push notification: "Tu reserva es en 1 hora"

[Usuario llega al LAN]
[Cajero] â†’ Usuario muestra QR desde app
         â†’ Cajero escanea QR en Dashboard
         â†’ Dashboard valida reserva
         â†’ Clic en "Check-in"

[Backend] â†’ Actualiza Reservation (status: CHECKED_IN)
          â†’ Inicia Session automÃ¡ticamente
          â†’ Aplica crÃ©dito del depÃ³sito

[Si usuario NO llega]
[Backend] â†’ Cron job detecta no-show (15 min despuÃ©s de hora reservada)
          â†’ Actualiza Reservation (status: NO_SHOW)
          â†’ Aplica penalizaciÃ³n (ej: pierde 50% del depÃ³sito)
          â†’ Crea Transaction (type: PENALTY)
          â†’ Libera PC para otros usuarios

5. COMUNICACIÃ“N EN TIEMPO REAL
5.1 WebSocket: Agent â†” Backend
PropÃ³sito: Mantener conexiÃ³n persistente para comandos crÃ­ticos
Eventos del Backend â†’ Agent:
typescriptSTART_SESSION     // Iniciar sesiÃ³n
PAUSE_SESSION     // Pausar (raro, pero posible)
END_SESSION       // Terminar sesiÃ³n
UPDATE_WHITELIST  // Actualizar apps permitidas
UPDATE_SETTINGS   // Cambiar tarifas, configuraciÃ³n
FORCE_RESTART     // Reiniciar PC remoto
SHOW_MESSAGE      // Mostrar mensaje al usuario
Eventos del Agent â†’ Backend:
typescriptHEARTBEAT         // Cada 60s: "sigo vivo"
SESSION_STARTED   // ConfirmaciÃ³n de inicio
SESSION_ENDED     // ConfirmaciÃ³n de fin
STATUS_UPDATE     // Estado de la PC
ERROR             // Reportar errores
OFFLINE_SYNC      // Sincronizar datos acumulados offline
TecnologÃ­a:

Backend: Socket.io (NestJS Gateway)
Agent: tokio-tungstenite (WebSocket client)

Resiliencia:

ReconexiÃ³n automÃ¡tica con exponential backoff
Buffer de mensajes durante desconexiÃ³n
Fallback a HTTP polling si WebSocket falla


5.2 WebSocket: Dashboard â†” Backend
PropÃ³sito: Actualizar UI en tiempo real sin polling
Eventos:
typescript// Backend â†’ Dashboard
PC_STATUS_CHANGED      // PC cambiÃ³ de estado (ocupado, libre, etc.)
SESSION_STARTED        // Nueva sesiÃ³n comenzÃ³
SESSION_ENDED          // SesiÃ³n finalizÃ³
NEW_ORDER              // Nueva orden de tienda
BALANCE_UPDATED        // Usuario recargÃ³ saldo
NEW_RESERVATION        // Nueva reserva creada

// Dashboard â†’ Backend
SUBSCRIBE_LAN          // Suscribirse a eventos de un LAN especÃ­fico
UNSUBSCRIBE_LAN        // Desuscribirse
```

**Room-based:** Cada LAN center tiene su "room" de Socket.io para aislar eventos

---

## 6. MODO OFFLINE (CRÃTICO)

### 6.1 Â¿QuÃ© funciona sin internet?
```
âœ… FUNCIONA OFFLINE:
- Iniciar sesiÃ³n (si ya se configurÃ³ previamente)
- Contar tiempo
- Calcular costo
- Bloqueo de aplicaciones (whitelist)
- Finalizar sesiÃ³n
- Guardar todo en SQLite local

âŒ NO FUNCIONA OFFLINE:
- Iniciar primera sesiÃ³n de un usuario nuevo
- Recargar saldo
- Sincronizar con dashboard en tiempo real
- Compras en tienda (no hay inventario actualizado)
```

### 6.2 Estrategia de SincronizaciÃ³n
```
[Internet se corta durante sesiones activas]

[Agent Service] 
â†’ Detecta pÃ©rdida de conexiÃ³n
â†’ ContinÃºa operando normalmente (timer local)
â†’ Guarda todos los eventos en SQLite:
  - session_events (heartbeats no enviados)
  - transactions_pending (finalizaciones)
â†’ Muestra en Tray: "âš ï¸ Modo offline"

[Internet vuelve]

[Agent Service]
â†’ Detecta reconexiÃ³n
â†’ Inicia proceso de sync:
  1. EnvÃ­a OFFLINE_SYNC con todos los eventos acumulados
  2. Backend valida y procesa en orden
  3. Backend responde con confirmaciones
  4. Agent borra registros sincronizados de SQLite
â†’ Muestra en Tray: "âœ… Conectado"

[Conflictos posibles]
- Usuario recargÃ³ saldo en otro LAN mientras este estaba offline
- SoluciÃ³n: Backend es source of truth, ajusta balance localmente
```

---

## 7. SEGURIDAD

### 7.1 AutenticaciÃ³n y AutorizaciÃ³n

**JWT Strategy:**
```
[Login]
â†’ Usuario envÃ­a credentials
â†’ Backend valida contra PostgreSQL (bcrypt)
â†’ Genera JWT (access_token + refresh_token)
â†’ access_token: expires en 15 min
â†’ refresh_token: expires en 7 dÃ­as, stored in Redis

[Request autenticado]
â†’ Frontend envÃ­a access_token en header: Authorization: Bearer <token>
â†’ Backend valida JWT
â†’ Si expirÃ³ pero <15 min â†’ acepta (grace period)
â†’ Si expirÃ³ >15 min â†’ rechaza, frontend usa refresh_token

[Refresh]
â†’ Frontend detecta 401
â†’ EnvÃ­a refresh_token a /auth/refresh
â†’ Backend valida contra Redis
â†’ Genera nuevo access_token
â†’ Usuario no se entera (seamless)
```

**RBAC (Role-Based Access Control):**
```
Roles y permisos:

SUPER_ADMIN (propietario):
â†’ Full access a todo
â†’ Puede crear managers

MANAGER (gerente):
â†’ Ver todos los reportes
â†’ Modificar tarifas
â†’ Gestionar inventario
â†’ Ver todas las sesiones
â†’ NO puede: eliminar datos crÃ­ticos, cambiar suscripciÃ³n

CASHIER (cajero):
â†’ Iniciar/terminar sesiones
â†’ Recargar saldo de clientes
â†’ Procesar Ã³rdenes de tienda
â†’ Ver reportes limitados (solo del dÃ­a actual)
â†’ NO puede: modificar tarifas, ver histÃ³rico completo

CLIENT (jugador):
â†’ Ver su propio perfil
â†’ Ver su historial
â†’ Hacer reservas
â†’ Recargar su saldo
â†’ NO puede: ver otros usuarios, acceder a dashboard admin
```

### 7.2 Seguridad del Agent

**PrevenciÃ³n de Tampering:**
```
1. Agent Service corre como SYSTEM (mÃ¡ximos privilegios)
2. Archivos protegidos con permisos restrictivos
3. SQLite local encriptado (sqlcipher)
4. ComunicaciÃ³n con backend: TLS 1.3 obligatorio
5. ValidaciÃ³n de certificados estricta
6. Agent verifica firma digital de updates antes de aplicar
```

**Whitelist Enforcement:**
```
- Procesos permitidos se definen en backend
- Agent sincroniza whitelist cada 1 hora
- Si falla sync: usa Ãºltima whitelist conocida
- Logs de todos los intentos de ejecuciÃ³n no autorizada
```

---

## 8. ESCALABILIDAD

### 8.1 ProyecciÃ³n de Carga
```
Escenario: 200 LAN Centers activos (objetivo 24 meses)

Promedio por LAN:
- 30 PCs
- 60% ocupaciÃ³n promedio
- 10 horas operaciÃ³n/dÃ­a

Total:
- 6,000 PCs totales
- 3,600 sesiones concurrentes en pico
- ~50,000 sesiones/dÃ­a
- ~1.5M sesiones/mes

WebSocket connections:
- 3,600 agents conectados simultÃ¡neamente
- ~500 dashboards abiertos
- Total: ~4,100 conexiones WS concurrentes
```

### 8.2 Estrategia de Escalamiento

**Fase 1 (1-50 LANs):**
```
Single VPS:
- 8 vCPUs
- 16 GB RAM
- NestJS app
- PostgreSQL
- Redis
- Todo en una mÃ¡quina

Costo: ~$80/mes (DigitalOcean)
```

**Fase 2 (51-100 LANs):**
```
Separar servicios:
- 1x App server (NestJS)
- 1x Database (PostgreSQL managed)
- 1x Redis managed
- Load balancer

Costo: ~$250/mes
```

**Fase 3 (101-200 LANs):**
```
Horizontal scaling:
- 3x App servers (behind load balancer)
- PostgreSQL read replicas
- Redis cluster
- Kubernetes para orquestaciÃ³n

Costo: ~$800/mes
```

**Fase 4 (200+ LANs):**
```
Multi-region:
- CDN para assets estÃ¡ticos
- Regional databases
- Edge caching
- Microservices separation (opcional)

Costo: ~$2,000/mes
```

---

## 9. MONITOREO Y OBSERVABILIDAD

### 9.1 MÃ©tricas CrÃ­ticas a Monitorear

**Application Metrics:**
```
- Request latency (p50, p95, p99)
- Error rate (por endpoint)
- WebSocket connections activas
- Sessions activas totales
- Queue depth (BullMQ jobs pending)
- Cache hit rate (Redis)
```

**Business Metrics:**
```
- Ingresos por hora
- Sesiones por LAN
- Tasa de ocupaciÃ³n por zona
- Average session duration
- Productos mÃ¡s vendidos
- Churn rate de clientes
```

**Infrastructure Metrics:**
```
- CPU/RAM usage (app servers)
- Database connections pool
- Disk I/O
- Network bandwidth
- Container restarts
```

### 9.2 Stack de Monitoreo
```
Prometheus â†’ Scrape metrics cada 15s
Grafana â†’ VisualizaciÃ³n de dashboards
Loki â†’ Logs centralizados
AlertManager â†’ Alertas (Slack, email)
Sentry â†’ Error tracking (frontend + backend)
Uptime Robot â†’ External monitoring (uptime checks)
```

### 9.3 Alertas CrÃ­ticas
```
CRITICAL (Slack + SMS):
- API down >2 min
- Database unavailable
- >50% agents offline
- Error rate >5%

WARNING (Slack):
- High latency (p95 >500ms)
- Database connections >80% pool
- Disk space <20%
- Memory >85%

INFO (Email):
- Nuevos LANs onboarded
- Daily revenue report
- Capacity planning warnings
```

---

## 10. PLAN DE DEPLOYMENT

### 10.1 Environments
```
DEVELOPMENT (local):
- Docker Compose
- Cada dev tiene su stack completo
- Mock data para testing

STAGING:
- Replica de producciÃ³n
- Deploy automÃ¡tico de main branch
- Testing pre-production
- Datos sintÃ©ticos realistas

PRODUCTION:
- Deploy manual (con aprobaciÃ³n)
- Blue-green deployment
- Rollback inmediato si problemas
- Datos reales
```

### 10.2 CI/CD Pipeline
```
GitHub Actions workflow:

[Push a feature branch]
â†’ Run linters (ESLint, cargo clippy)
â†’ Run tests (unit + integration)
â†’ Build artifacts
â†’ Si pasa â†’ allow merge to main

[Merge to main]
â†’ Run full test suite
â†’ Build Docker images
â†’ Push to registry
â†’ Deploy to STAGING automÃ¡ticamente
â†’ Run smoke tests
â†’ Notificar en Slack: "Staging deployed"

[Release to PRODUCTION]
â†’ Manual approval required
â†’ Create release tag (v1.2.3)
â†’ Deploy to production
â†’ Health checks
â†’ Si falla â†’ automatic rollback
â†’ Notificar en Slack: "Prod deployed v1.2.3"
```

### 10.3 Database Migrations
```
Estrategia:
- Prisma Migrate para schema changes
- Migrations versionadas en Git
- Deploy process:
  1. Backup database
  2. Run migrations (con timeout)
  3. Verify data integrity
  4. Deploy new app version
  5. Si falla â†’ rollback migration + app
  
Migrations peligrosas:
- Dropping columns â†’ requiere 2-phase deploy
  Fase 1: App deja de usar columna
  Fase 2 (semanas despuÃ©s): Drop columna
```

---

## 11. COSTOS PROYECTADOS (Detallado)

### 11.1 Desarrollo (AÃ±o 1)
```
PERSONAL:
â”œâ”€ 1x Tech Lead (Rust + Node.js)
â”‚  â””â”€ $5,000/mes Ã— 12 = $60,000
â”‚
â”œâ”€ 1x Full-stack Dev (Node.js + React)
â”‚  â””â”€ $4,000/mes Ã— 12 = $48,000
â”‚
â”œâ”€ 0.5x Frontend Dev (Next.js + Flutter)
â”‚  â””â”€ $3,500/mes Ã— 6 = $21,000
â”‚
â”œâ”€ 0.5x QA Engineer
â”‚  â””â”€ $2,500/mes Ã— 6 = $15,000
â”‚
â””â”€ 0.25x UI/UX Designer (freelance)
   â””â”€ $2,000/mes Ã— 3 = $6,000

TOTAL PERSONAL: $150,000
```

### 11.2 Infraestructura (AÃ±o 1)
```
CLOUD (AWS / DigitalOcean):
â”œâ”€ VPS (8 vCPU, 16GB) Ã— 12 = $960
â”œâ”€ PostgreSQL managed Ã— 12 = $1,800
â”œâ”€ Redis managed Ã— 12 = $600
â”œâ”€ S3/MinIO storage Ã— 12 = $240
â”œâ”€ CDN (Cloudflare) Ã— 12 = $240
â””â”€ Backup storage Ã— 12 = $180

SERVICES:
â”œâ”€ Domain + SSL = $50
â”œâ”€ Sentry (error tracking) Ã— 12 = $300
â”œâ”€ Monitoring (Grafana Cloud) Ã— 12 = $600
â”œâ”€ Email service (SendGrid) Ã— 12 = $180
â”œâ”€ SMS (Twilio) Ã— 12 = $600
â””â”€ Payment gateway fees (2.9% + $0.30)
   â””â”€ Estimado: $1,200

TOTAL INFRA: $6,950
```

### 11.3 Marketing & Legal (AÃ±o 1)
```
MARKETING:
â”œâ”€ Landing page design = $2,000
â”œâ”€ Brand identity = $1,500
â”œâ”€ Content marketing Ã— 12 = $6,000
â”œâ”€ Ads (Google/Meta) Ã— 12 = $6,000
â””â”€ Video demos/tutorials = $3,000

LEGAL & ADMIN:
â”œâ”€ Company registration = $1,000
â”œâ”€ Lawyer (contracts, ToS) = $2,500
â”œâ”€ Accountant Ã— 12 = $3,600
â””â”€ Insurance = $1,500

TOTAL MARKETING + LEGAL: $27,100
```

### 11.4 Total AÃ±o 1
```
Personal:       $150,000
Infraestructura:  $6,950
Marketing/Legal: $27,100
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
TOTAL:          $184,050

Con 20% buffer para imprevistos: ~$220,000
```

---

## 12. MODELO DE MONETIZACIÃ“N (Detallado)

### 12.1 Pricing Tiers
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STARTER                                     $49/mes â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ Hasta 15 PCs                                     â”‚
â”‚  â€¢ Core features (sessions, billing, users)          â”‚
â”‚  â€¢ 1 zona                                           â”‚
â”‚  â€¢ 2 usuarios admin                                 â”‚
â”‚  â€¢ Email support (48h response)                     â”‚
â”‚  â€¢ Reports bÃ¡sicos                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PROFESSIONAL                               $129/mes â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ Hasta 40 PCs                                     â”‚
â”‚  â€¢ Todo de Starter +                                â”‚
â”‚  â€¢ Tienda integrada                                 â”‚
â”‚  â€¢ Sistema de reservas                              â”‚
â”‚  â€¢ Zonas ilimitadas                                 â”‚
â”‚  â€¢ 5 usuarios admin                                 â”‚
â”‚  â€¢ Loyalty program                                  â”‚
â”‚  â€¢ Chat support (24h response)                      â”‚
â”‚  â€¢ Reports avanzados + exports                      â”‚
â”‚  â€¢ Mobile app                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BUSINESS                                   $299/mes â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ Hasta 80 PCs                                     â”‚
â”‚  â€¢ Todo de Professional +                           â”‚
â”‚  â€¢ Analytics con IA (pricing, forecasting)          â”‚
â”‚  â€¢ Tournament manager                               â”‚
â”‚  â€¢ API access                                       â”‚
â”‚  â€¢ Usuarios admin ilimitados                        â”‚
â”‚  â€¢ Multi-ubicaciÃ³n (hasta 3 sucursales)             â”‚
â”‚  â€¢ Priority support (12h response)                  â”‚
â”‚  â€¢ White-label (remove eControl branding)           â”‚
â”‚  â€¢ Custom integrations                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ENTERPRISE                             Custom price â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ PCs ilimitadas                                   â”‚
â”‚  â€¢ Todo de Business +                               â”‚
â”‚  â€¢ Dedicated support (4h response)                  â”‚
â”‚  â€¢ On-premise deployment option                     â”‚
â”‚  â€¢ SLA 99.9% uptime guaranteed                      â”‚
â”‚  â€¢ Custom features development                      â”‚
â”‚  â€¢ Multi-ubicaciÃ³n ilimitada                        â”‚
â”‚  â€¢ Training & onboarding personalizado              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 12.2 Ingresos Proyectados
```
ESCENARIO CONSERVADOR (AÃ±o 1):

Mes 1-3 (Beta):
- 5 clientes Ã— $0 (gratis) = $0

Mes 4-6:
- 10 clientes Ã— $49 (Starter) = $490/mes

Mes 7-9:
- 20 clientes Ã— $70 (mix tiers) = $1,400/mes

Mes 10-12:
- 35 clientes Ã— $85 (mix tiers) = $2,975/mes

Total AÃ±o 1: ~$20,000 MRR final â†’ ~$85,000 ARR acumulado

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ESCENARIO OPTIMISTA (AÃ±o 1):

Mes 1-3: $0
Mes 4-6: 25 clientes Ã— $60 = $1,500/mes
Mes 7-9: 60 clientes Ã— $75 = $4,500/mes
Mes 10-12: 100 clientes Ã— $90 = $9,000/mes

Total AÃ±o 1: $9,000 MRR final â†’ $190,000 ARR acumulado

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ESCENARIO REALISTA (entre ambos):

AÃ±o 1: ~$130,000 ingresos totales
AÃ±o 2: ~$450,000 (150 clientes Ã— $250 MRR promedio)

Break-even: Mes 18-20
```

---

## 13. ROADMAP CONSOLIDADO

### 13.1 Pre-Development (Mes 0)
```
SEMANA 1-2: ValidaciÃ³n
â”œâ”€ Entrevistar 15 dueÃ±os de LANs
â”œâ”€ Survey online (50+ respuestas)
â”œâ”€ Competitive analysis profundo
â””â”€ Validar willingness to pay

SEMANA 3-4: DiseÃ±o
â”œâ”€ Wireframes (Figma)
â”œâ”€ User flows completos
â”œâ”€ Database schema final
â”œâ”€ API contracts (OpenAPI spec)
â””â”€ DecisiÃ³n de financiamiento
```

### 13.2 MVP Development (Mes 1-6)
```
MES 1: Foundation
â”œâ”€ Setup monorepo
â”œâ”€ CI/CD pipelines
â”œâ”€ Docker Compose dev environment
â”œâ”€ Database schema (Prisma)
â”œâ”€ Auth system (JWT)
â””â”€ Rust Agent scaffold

MES 2-3: Core Agent
â”œâ”€ Windows Service funcional
â”œâ”€ Session timer local
â”œâ”€ SQLite offline storage
â”œâ”€ WebSocket client
â”œâ”€ Process monitoring
â””â”€ Kiosk mode bÃ¡sico

MES 3-4: Backend Core
â”œâ”€ Sessions API (CRUD)
â”œâ”€ Users API (CRUD)
â”œâ”€ PCs API (CRUD)
â”œâ”€ WebSocket gateway
â”œâ”€ Billing engine
â””â”€ Basic reports

MES 4-5: Dashboard MVP
â”œâ”€ Next.js setup
â”œâ”€ Authentication
â”œâ”€ PC map (real-time status)
â”œâ”€ Start/end sessions
â”œâ”€ User management
â””â”€ Daily reports (X, Z)

MES 5-6: Tauri UI
â”œâ”€ System tray app
â”œâ”€ Session overlay
â”œâ”€ Extend time functionality
â”œâ”€ API integration
â””â”€ Polish & testing

DELIVERABLE Mes 6: 
âœ… MVP funcional para 3 beta testers
```

### 13.3 Beta & Iteration (Mes 7-9)
```
MES 7:
â”œâ”€ Onboard 5 beta LANs
â”œâ”€ Gathering feedback
â”œâ”€ Bug fixing sprint
â””â”€ Performance optimization

MES 8:
â”œâ”€ Reservations system
â”œâ”€ Integrated store
â”œâ”€ Mobile app (Flutter) MVP
â””â”€ Email/SMS notifications

MES 9:
â”œâ”€ Loyalty program
â”œâ”€ Advanced reports
â”œâ”€ Payment integrations (Stripe, Mercado Pago)
â””â”€ Polish UI/UX based on feedback
```

### 13.4 Launch (Mes 10-12)
```
MES 10:
â”œâ”€ Public launch
â”œâ”€ Marketing campaign
â”œâ”€ Landing page optimized
â”œâ”€ Documentation completa
â””â”€ Video tutorials

MES 11-12:
â”œâ”€ Scale infrastructure
â”œâ”€ Customer success efforts
â”œâ”€ Feature requests prioritization
â””â”€ Prepare for AÃ±o 2 features
```

### 13.5 Year 2 Features
```
Q1 (Mes 13-15):
â””â”€ Analytics AI (dynamic pricing, forecasting)

Q2 (Mes 16-18):
â””â”€ Tournament manager

Q3 (Mes 19-21):
â””â”€ API pÃºblica + marketplace de plugins

Q4 (Mes 22-24):
â””â”€ Multi-ubicaciÃ³n
â””â”€ White-label option
```

---

## 14. RIESGOS Y MITIGACIONES (Consolidado)

### 14.1 TÃ©cnicos

| Riesgo | Probabilidad | Impacto | MitigaciÃ³n |
|--------|--------------|---------|------------|
| Agent crashea PCs de clientes | Media | CRÃTICO | Testing exhaustivo en 20+ configs de hardware antes de launch. Rollback automÃ¡tico. |
| Sync offline-online pierde datos | Media | Alto | Idempotent APIs. Transaction log con checksums. Testing de desconexiones. |
| Escalabilidad: backend colapsa con 100+ LANs | Media | Alto | Load testing desde Mes 6. Horizontal scaling preparado. Caching agresivo. |
| Hack de base de datos | Baja | CRÃTICO | Encryption at rest. RBAC estricto. Pentesting antes de launch. Compliance con PCI-DSS para pagos. |
| Windows updates rompen Agent | Alta | Medio | Compatibility layer. Monitoring de versiones Windows. Auto-update del Agent. |

### 14.2 Mercado

| Riesgo | Probabilidad | Impacto | MitigaciÃ³n |
|--------|--------------|---------|------------|
| Competidores reducen precio a $0 (freemium) | Alta | Alto | Diferenciarse por UX, features Ãºnicos (IA, modo offline robusto). Customer success. |
| AdopciÃ³n lenta (LANs prefieren Excel) | Alta | CRÃTICO | Freemium tier (15 PCs gratis). Onboarding en <2h. ROI calculator en landing. |
| Cloud gaming mata LANs fÃ­sicos | Media | Alto | Pivotar a modelo hÃ­brido. LANs como "esports hubs". Eventos sociales. |
| RegulaciÃ³n (GDPR, protecciÃ³n menor) | Baja | Medio | Compliance desde dÃ­a 1. Consultor legal. Parental controls. |

### 14.3 Financieros

| Riesgo | Probabilidad | Impacto | MitigaciÃ³n |
|--------|--------------|---------|------------|
| No alcanzar break-even en 24 meses | Media | CRÃTICO | Buscar seed funding ($150-250k). Reducir burn rate (equipo offshore). Revenue share model alternativo. |
| Churn rate >10%/mes | Media | Alto | Customer success proactivo. NPS tracking. Feature requests rÃ¡pidos. |
| Costos de infra explotan | Baja | Medio | Monitoring de costos. OptimizaciÃ³n continua. Reserved instances. |
| Falta de capital para marketing | Alta | Alto | Growth hacking. Content marketing (SEO). Referral program. Community building. |

---

## 15. MÃ‰TRICAS DE Ã‰XITO (KPIs Definitivos)

### 15.1 Product Metrics
```
MVP (Mes 6):
â”œâ”€ 3 beta LANs usando el producto
â”œâ”€ 95% uptime
â”œâ”€ <5 bugs crÃ­ticos reportados
â””â”€ Agent footprint <50 MB RAM

Launch (Mes 12):
â”œâ”€ 50 LANs pagando
â”œâ”€ 99% uptime
â”œâ”€ NPS >30
â”œâ”€ Avg session start time <30 segundos
â””â”€ Churn rate <8%/mes

AÃ±o 2:
â”œâ”€ 200 LANs activos
â”œâ”€ 99.5% uptime
â”œâ”€ NPS >50
â””â”€ Churn rate <5%/mes
```

### 15.2 Business Metrics
```
Mes 12:
â”œâ”€ MRR: $4,000
â”œâ”€ ARR: ~$130,000
â”œâ”€ CAC: <$200
â”œâ”€ LTV: >$2,000
â””â”€ LTV:CAC ratio: >10:1

AÃ±o 2:
â”œâ”€ MRR: $37,500 (150 LANs Ã— $250 avg)
â”œâ”€ ARR: $450,000
â”œâ”€ CAC: <$150
â”œâ”€ LTV: >$3,500
â”œâ”€ LTV:CAC ratio: >23:1
â””â”€ Gross margin: 80%+
```

### 15.3 Technical Metrics
```
Performance:
â”œâ”€ API p95 latency: <200ms
â”œâ”€ Dashboard load time: <2s
â”œâ”€ Agent startup: <3s
â””â”€ WebSocket reconnect: <5s

Reliability:
â”œâ”€ Error rate: <0.1%
â”œâ”€ Failed deployments: <5%
â””â”€ Mean time to recovery: <15 min

Adoption:
â”œâ”€ % LANs using mobile app: >40%
â”œâ”€ % sessions with store purchases: >25%
â””â”€ % clients with loyalty account: >60%
```

---

## 16. DECISIONES PENDIENTES

### 16.1 Preguntas que Resolver AHORA
```
1. FINANCIAMIENTO:
   Â¿Bootstrapping o buscar inversiÃ³n?
   â””â”€ Si inversiÃ³n: Â¿CuÃ¡nto? Â¿Angels o VC?

2. TEAM:
   Â¿In-house o offshore?
   â””â”€ Si offshore: Â¿QuÃ© regiÃ³n? (LATAM, Eastern Europe, Asia)

3. PRICING:
   Â¿Revenue share o SaaS puro?
   â””â”€ Â¿Tier gratis o solo trial?

4. MERCADO INICIAL:
   Â¿Un solo paÃ­s o regional desde dÃ­a 1?
   â””â”€ Â¿QuÃ© paÃ­s? (PerÃº, MÃ©xico, Colombia, Chile?)

5. TECH:
   Â¿Self-hosted option desde MVP o solo cloud?
   â””â”€ Algunos LANs grandes pueden querer on-premise
```

### 16.2 Decisiones para Mes 3-6
```
1. Payment gateways especÃ­ficos por paÃ­s
2. Compliance regional (facturaciÃ³n electrÃ³nica)
3. Contratar customer success person
4. Estrategia de partnerships (hardware vendors)
```

---

## 17. SIGUIENTE PASO INMEDIATO

### Si apruebas este plan, lo siguiente es:
```
FASE 0: VALIDACIÃ“N (2 semanas)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DÃ­a 1-3:                                       â”‚
â”‚ â””â”€ Crear lista de 50 LANs para entrevistar    â”‚
â”‚                                                â”‚
â”‚ DÃ­a 4-10:                                      â”‚
â”‚ â””â”€ Hacer 15 entrevistas (30 min c/u)          â”‚
â”‚    Preguntas:                                  â”‚
â”‚    â€¢ Â¿QuÃ© software usan hoy?                   â”‚
â”‚    â€¢ Â¿QuÃ© les frustra?                         â”‚
â”‚    â€¢ Â¿PagarÃ­an $50-150/mes por soluciÃ³n?       â”‚
â”‚    â€¢ Â¿QuÃ© features son must-have?              â”‚
â”‚                                                â”‚
â”‚ DÃ­a 11-14:                                     â”‚
â”‚ â””â”€ AnÃ¡lisis de entrevistas                     â”‚
â”‚ â””â”€ Ajustar roadmap segÃºn feedback              â”‚
â”‚ â””â”€ Decidir: GO / NO-GO / PIVOT                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Si GO â†’ Arrancar Mes 1 del roadmap
Si NO-GO â†’ Iterar o pivotar
Si PIVOT â†’ Redefinir y volver a validar
```

---

## 18. DOCUMENTOS A CREAR POST-APROBACIÃ“N
```
1. Technical Specification Document (TSD)
   â””â”€ 50-80 pÃ¡ginas de specs tÃ©cnicas detalladas

2. API Documentation (OpenAPI)
   â””â”€ Todos los endpoints documentados

3. Database Schema (ERD completo)
   â””â”€ Con constraints, Ã­ndices, relaciones

4. UI/UX Design System
   â””â”€ Figma con todos los componentes

5. Business Plan Ejecutivo
   â””â”€ Para pitch a inversionistas

6. User Manual (Draft)
   â””â”€ Para beta testers

7. Marketing Plan
   â””â”€ Go-to-market strategy detallada
```

---

## RESUMEN EJECUTIVO FINAL
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ECONTROL: DECISIONES CLAVE                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STACK:
âœ“ Agent: Rust Service + Tauri UI
âœ“ Backend: Node.js + NestJS
âœ“ Admin: Next.js 14 (App Router)
âœ“ Mobile: Flutter
âœ“ Database: PostgreSQL + Redis

ARQUITECTURA:
âœ“ Monorepo (pnpm workspaces)
âœ“ Microservicios (NestJS modules)
âœ“ Modo offline robusto (SQLite sync)
âœ“ Real-time (WebSockets)

MODELO NEGOCIO:
âœ“ SaaS subscription ($49-$299/mes)
âœ“ 4 tiers (Starter â†’ Enterprise)
âœ“ Freemium considerado (hasta 10 PCs)

TIMELINE:
âœ“ MVP: 6 meses
âœ“ Beta: Mes 7-9
âœ“ Launch: Mes 10
âœ“ Break-even: Mes 18-20

INVERSIÃ“N:
âœ“ AÃ±o 1: ~$220k (con buffer)
âœ“ Financiamiento: TBD (bootstrapping vs seed)

MÃ‰TRICAS Ã‰XITO:
âœ“ Mes 12: 50 LANs, $4k MRR
âœ“ AÃ±o 2: 200 LANs, $37k MRR

RIESGO MAYOR:
âœ“ Ado